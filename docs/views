# üìÖ Views ‚Äì Agenda Di√°ria (PostgreSQL)

## 1Ô∏è‚É£ View: Agenda di√°ria completa da crian√ßa

üëâ Mostra **todos os eventos do dia**, com crian√ßa, turma e educador.

```sql
CREATE OR REPLACE VIEW vw_agenda_diaria AS
SELECT
    e.id                  AS evento_id,
    e.data_hora::DATE     AS data_agenda,
    e.data_hora           AS data_hora_evento,
    e.tipo                AS tipo_evento,
    e.descricao,

    c.id                  AS crianca_id,
    c.nome                AS nome_crianca,

    t.id                  AS turma_id,
    t.nome                AS nome_turma,

    u.id                  AS educador_id,
    u.nome                AS nome_educador

FROM eventos_agenda e
JOIN criancas c       ON c.id = e.crianca_id
JOIN turmas t         ON t.id = c.turma_id
JOIN usuarios u       ON u.id = e.educador_id
WHERE c.ativa = TRUE
  AND t.ativo = TRUE;
```

### Uso:

```sql
SELECT *
FROM vw_agenda_diaria
WHERE crianca_id = 1
  AND data_agenda = CURRENT_DATE
ORDER BY data_hora_evento;
```

---

## 2Ô∏è‚É£ View: Agenda di√°ria por respons√°vel

üëâ Perfeita para o **app dos pais** üë®‚Äçüë©‚Äçüëß
Retorna apenas eventos das crian√ßas vinculadas ao respons√°vel.

```sql
CREATE OR REPLACE VIEW vw_agenda_diaria_responsavel AS
SELECT
    r.id                  AS responsavel_id,
    r.nome                AS nome_responsavel,

    c.id                  AS crianca_id,
    c.nome                AS nome_crianca,

    e.data_hora::DATE     AS data_agenda,
    e.data_hora           AS data_hora_evento,
    e.tipo                AS tipo_evento,
    e.descricao,

    u.nome                AS nome_educador

FROM responsaveis r
JOIN criancas_responsaveis cr ON cr.responsavel_id = r.id
JOIN criancas c               ON c.id = cr.crianca_id
JOIN eventos_agenda e         ON e.crianca_id = c.id
JOIN usuarios u               ON u.id = e.educador_id
WHERE c.ativa = TRUE;
```

### Uso:

```sql
SELECT *
FROM vw_agenda_diaria_responsavel
WHERE responsavel_id = 5
  AND data_agenda = CURRENT_DATE
ORDER BY nome_crianca, data_hora_evento;
```

---

## 3Ô∏è‚É£ View: Agenda di√°ria por turma (educador)

üëâ Educador v√™ **toda a turma no dia**, organizado e bonito.

```sql
CREATE OR REPLACE VIEW vw_agenda_diaria_turma AS
SELECT
    t.id                  AS turma_id,
    t.nome                AS nome_turma,

    c.id                  AS crianca_id,
    c.nome                AS nome_crianca,

    e.data_hora::DATE     AS data_agenda,
    e.data_hora           AS data_hora_evento,
    e.tipo                AS tipo_evento,
    e.descricao

FROM turmas t
JOIN criancas c       ON c.turma_id = t.id
JOIN eventos_agenda e ON e.crianca_id = c.id
WHERE t.ativo = TRUE
  AND c.ativa = TRUE;
```

### Uso:

```sql
SELECT *
FROM vw_agenda_diaria_turma
WHERE turma_id = 2
  AND data_agenda = CURRENT_DATE
ORDER BY nome_crianca, data_hora_evento;
```

---

## 4Ô∏è‚É£ View: Resumo di√°rio da crian√ßa (dashboard üî•)

üëâ Uma linha por crian√ßa no dia (√≥timo pra vis√£o r√°pida).

```sql
CREATE OR REPLACE VIEW vw_resumo_diario_crianca AS
SELECT
    c.id                      AS crianca_id,
    c.nome                    AS nome_crianca,
    e.data_hora::DATE         AS data_agenda,

    COUNT(e.id)               AS total_eventos,
    BOOL_OR(e.tipo = 'ENTRADA') AS teve_entrada,
    BOOL_OR(e.tipo = 'SAIDA')   AS teve_saida

FROM criancas c
LEFT JOIN eventos_agenda e ON e.crianca_id = c.id
WHERE c.ativa = TRUE
GROUP BY c.id, c.nome, data_agenda;
```

